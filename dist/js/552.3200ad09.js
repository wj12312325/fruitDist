"use strict";(self["webpackChunkfruit_netshop"]=self["webpackChunkfruit_netshop"]||[]).push([[552],{552:function(s,t,e){e.r(t),e.d(t,{default:function(){return l}});var a=function(){var s=this,t=s._self._c;return t("div",{staticClass:"aa"},[t("div",{staticClass:"trade-container"},[t("el-steps",{staticStyle:{margin:"20px 0 30px 0"},attrs:{active:1,"align-center":"","finish-status":"success"}},[t("el-step",{attrs:{title:"核对订单",description:"请核对订单并选择收货地址"}}),t("el-step",{attrs:{title:"支付订单",description:"请选择支付方式并进行支付"}}),t("el-step",{attrs:{title:"生成订单",description:"支付成功，订单已生成，请等待发货，感谢您的支持！"}})],1),t("h3",{staticClass:"title"},[s._v("填写并核对订单信息")]),t("div",{staticClass:"content"},[t("h5",{staticClass:"receive"},[s._v("收件人信息")]),s._l(s.addressList,(function(e){return t("div",{key:e.id,staticClass:"address clearFix"},[t("span",{staticClass:"username",class:{selected:1==e.selected},on:{click:function(t){return s.changeAddress(e,s.addressList)}}},[s._v(s._s(e.consignee))]),t("p",{on:{click:function(t){return s.changeAddress(e,s.addressList)}}},[t("span",{staticClass:"s1"},[s._v(s._s(e.fullAddress))]),t("span",{staticClass:"s2"},[s._v(s._s(e.phone))]),t("span",{directives:[{name:"show",rawName:"v-show",value:1==e.is_default,expression:"address.is_default == true"}],staticClass:"s4"},[s._v("默认地址")]),t("span",{directives:[{name:"show",rawName:"v-show",value:1==e.selected,expression:"address.selected == true"}],staticClass:"s3"},[s._v("已选择")])])])})),t("div",{staticClass:"line"}),t("h5",{staticClass:"pay"},[s._v("支付方式")]),s._m(0),t("div",{staticClass:"line"}),t("h5",{staticClass:"pay"},[s._v("送货清单")]),t("div",{staticClass:"way"},[t("h5",{staticStyle:{"font-size":"16px","letter-spacing":"1px"}},[s._v("配送方式")]),t("div",{staticClass:"info clearFix"},[t("img",{attrs:{src:e(8273),alt:""}}),t("p",{staticClass:"time"},[s._v(" 配送时间："),t("span",[s._v(s._s(`${s.Estimated()} 9:00~15:00`))]),s._v(" 送达 ")])])]),t("div",{staticClass:"detail"},[t("h5",{staticStyle:{"font-size":"16px","letter-spacing":"1px"}},[s._v("商品清单")]),s._l(s.cartList,(function(e){return t("ul",{key:e.id,staticClass:"list clearFix"},[t("li",[t("img",{staticClass:"goodsImg",attrs:{src:`${s.srcUrl}${e.goods_info.goods_img[0]}`}})]),t("li",[t("p",[s._v(s._s(e.goods_info.goods_name))]),t("h4",[s._v("7天无理由退货")])]),t("li",[t("h3",[s._v("￥"+s._s(e.goods_info.goods_price))])]),t("li",{staticClass:"number"},[s._v("X"+s._s(e.number))]),t("li",{staticStyle:{"font-size":"16px"}},[s._v("有货")])])}))],2),t("div",{staticClass:"bbs"},[t("h5",{staticClass:"bbs1"},[s._v("买家留言：")]),t("el-input",{staticClass:"remarks-cont",attrs:{placeholder:"建议留言前先与商家沟通确认",type:"textarea",rows:4},model:{value:s.order_remark,callback:function(t){s.order_remark=t},expression:"order_remark"}})],1)],2),t("div",{staticClass:"foo"},[t("div",{staticClass:"trade"},[t("div",{staticClass:"num"},[s._v(" 商品数量："),t("span",[s._v(s._s(s.cartList.length))])]),t("div",{staticClass:"price"},[s._v(" 应付金额:　"),t("span",[s._v("¥"+s._s(s.totalMoney()))])]),t("div",{staticClass:"receiveInfo"},[t("span",{staticClass:"t1"},[s._v(" 寄送至:")]),t("span",{staticClass:"span1"},[s._v(s._s(s.userDefaultAddress.fullAddress))])]),t("div",{staticClass:"con"},[t("span",{staticClass:"t2"},[s._v("收货人：")]),t("span",{staticClass:"span2"},[s._v(s._s(s.userDefaultAddress.consignee))]),t("span",{staticClass:"span3"},[s._v(s._s(s.userDefaultAddress.phone))])])]),t("div",{staticClass:"sub clearFix"},[t("div",{on:{click:s.submitOrder}},[s._v("提交订单")])])])],1)])},i=[function(){var s=this,t=s._self._c;return t("div",{staticClass:"address clearFix"},[t("span",{staticClass:"username selected"},[s._v("在线支付")])])}],r=(e(7658),e(3822)),d={name:"Trade",data(){return{pageNum:1,pageSize:1e3,order_remark:"",address_id:0,goods_id:"",goods_number:"",total:0,orderId:0}},async mounted(){await this.getAddress(),await this.getCart(),await this.getUserInfo()},methods:{async getAddress(){await this.$store.dispatch("address/getAddressList",{pageNum:this.pageNum,pageSize:this.pageSize,user_id:this.userInfo.id}),this.address_id=this.addressList.find((s=>1==s.is_default)).id},async getCart(){await this.$store.dispatch("cart/getCartList",{id:this.userInfo.id,pageNum:this.pageNum,pageSize:this.pageSize,selected:1});let s=[],t=[];for(let e of this.cartList)s.push(e.goods_info.id),t.push(e.number);this.goods_id=s.toString(),this.goods_number=t.toString()},async getUserInfo(){await this.$store.dispatch("user/getUserInfo")},changeAddress(s,t){t.forEach((s=>{s.selected=!1})),s.selected=!0,this.address_id=s.id},Estimated(){let s=new Date;var t=s.getDate();return t+=2,s.setDate(t),this.dayjs(s).format("YYYY-MM-DD")},totalMoney(){let s=0;return this.cartList.forEach((t=>{s+=t.number*t.goods_info.goods_price})),this.total=s.toFixed(2),s.toFixed(2)},async updateGoods(){for(let t of this.cartList){let e=0;e=t.goods_info.goods_num-t.number;let a={id:t.id,goods_num:e};try{await this.$store.dispatch("goods/updateGoods",a)}catch(s){this.$message({type:"error",message:s})}}},async submitOrder(){try{const{goods_id:s,address_id:t,goods_number:e,order_remark:a,total:i}=this;let r={address_id:t,goods_id:s,goods_number:e,total:1*i,order_remark:a};r.order_remark||delete r.order_remark;const d=await this.$store.dispatch("order/addOrder",r);let o=[];for(let n of this.cartList)o.push(n.id);let c={ids:o};await this.$store.dispatch("cart/deleteCart",c),this.orderId=d,this.$router.push(`/pay?orderId=${this.orderId}&&totalFee=${this.total}`),this.updateGoods(),this.$message({type:"success",message:"生成订单成功"})}catch(s){this.$message({type:"error",message:s})}}},computed:{...(0,r.rn)({addressList:s=>s.address.addressList||[],cartList:s=>s.cart.cartList||[],userInfo:s=>s.user.userInfo||{}}),userDefaultAddress(){return this.addressList.find((s=>1==s.is_default))||{}}}},o=d,c=e(1001),n=(0,c.Z)(o,a,i,!1,null,"b0ed570e",null),l=n.exports},8273:function(s,t,e){s.exports=e.p+"img/2.10a05bf7.jpg"}}]);
//# sourceMappingURL=552.3200ad09.js.map